<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herp Derp</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@7.0.0-beta.3/babel.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <section id="app">
    </section>
     <script>
        // to simulate async data fetching
        window.API = {
            fetchFrahnds(){
                return new Promise((res, rej) => {
                    const frahnds = [// frahnds data dumped here
                        {
                            name: 'Jake',
                            active: true,
                            key: 'Jake',
                        }, 
                        {
                            name: 'Amy',
                            active: true,
                            key: 'Amy',
                        }, 
                        {
                            name: 'Raymond',
                            active: true,
                            key: 'Raymond',
                        }, 
                        {
                            name: 'Charles',
                            active: true,
                            key: 'Charles',
                        },
                        {
                            name: 'Rosa',
                            active: true,
                            key: 'Rosa',
                        }, 
                        {
                            name: 'Terry',
                            active: true,
                            key: 'Terry',
                        }
                    ]
                    setTimeout(()=> res(frahnds), 2000) //resolve with the frahnds after 2s. faking the async nature of an ajax req
                })
            }
        }
    </script>

    <script type="text/babel">
        function FrahndsList(props){
            const activeTemplate = (
                <ul>
                    {props.list
                        .filter(frahnd => frahnd.active === true)
                        .map(frahnd => (
                        <li key={frahnd.key}> {/*create key on creation, not half-assed here*/}
                            <span>{frahnd.name}</span>
                            {/*here you're coming in from adding the prop from line 85 or so from what App component is returning, adding button for the remove. 
                                How does it know this is the name you want to remove? bc you are still inside context of the .map, thus "name" is same value for all these attributes */}
                            <button onClick = { ()=> {props.onRemoveFriend(frahnd.name)} }>Bye {frahnd.name}!</button>
                            <button onClick = { ()=> {props.onActivation(frahnd.name, false)} }>Deactivate</button>
                        </li>
                    ))}
                </ul>
            )
            // inactive friends have an activate button
            const inactiveTemplate = (
                <ul>
                    {props.list
                        .filter(frahnd => frahnd.active === false)
                        .map(frahnd => (
                        <li key={props.list.indexOf(frahnd)}> {/*tweaked this too*/}
                            <span>{frahnd.name}</span>
                            {/*here you're coming in from adding the prop from line 85 or so from what App component is returning, adding button for the remove. 
                                How does it know this is the name you want to remove? bc you are still inside context of the .map, thus "name" is same value for all these attributes */}
                            <button onClick = { ()=> {props.onRemoveFriend(frahnd.name)} }>Bye {frahnd.name}!</button>
                            <button onClick = { ()=> {props.onActivation(frahnd.name, true)} }>Activate</button>
                        </li>
                    ))}
                </ul>
            )
            return (
                props.list.length === 0 ? Loader() :
                    props.isActive === true ? activeTemplate : inactiveTemplate )  
            // if still fetching data, show Loader; otherwise show the appropriate template  
        }

        function Loader(){
            return (
                <h3>I'm loading so be patient, k?</h3>
            )
        }

        function App(){
            const { useState, useEffect} = React; //destructure from React. not working: Suspense 
            const [frahndqueue, setFrahndqueue] = useState([]);
            const [newFrahnd, setNewFrahnd] = useState('')

            useEffect(()=> { //takes a function as an arg
                API.fetchFrahnds()
                    .then(frahnds => {
                        const hereFrahnds = frahnds;
                        setFrahndqueue(hereFrahnds);
                    })
            }, []) //but is this empty dep array true?

            // set function to eyeball the value in the input for new friend name and set it
            function handleChange(e){
                setNewFrahnd(e.target.value)
            }

            // make a function to add items to the state
            function handleAddFriend(name){
                if (frahndqueue.filter(frahnd => frahnd.name === name).length === 0){
                    const updatedFrahndQueue = frahndqueue.concat({name, active: true, key: frahnd.name }) //this is a crappy key handling but 

                    setFrahndqueue(updatedFrahndQueue) //now you make frahndqueue equal its updated self with the new frahnd
                    // default adds to active friends category
                    setNewFrahnd('') //clearing it after submission is best practice I think
                }
            }
            function handleActivation(name, currentSitch){
                const editedFrahndqueue = frahndqueue.map(frahnd => {
                    if (frahnd.name === name){
                        frahnd.active = currentSitch;
                        return frahnd; //do I need this bit?
                    } else {
                        return frahnd;
                    }
                })
                setFrahndqueue(editedFrahndqueue);
            }
            // make a function to clear all friends
            function clearAll(){
                // notice this has to be an empty array not an empty string - otherwise the .map malfunctions in the FrahndsList component
                setFrahndqueue([])
            }
            // make a function to remove items from the state
            function handleRemoveFriend(name){
                const updatedFrahnds = frahndqueue.filter(friend => friend.name!==name)
                setFrahndqueue(updatedFrahnds)
            }

            return (
                <section id="container"> 
                    <h1>An odd tracker</h1>
                    <input 
                        type='text'
                        placeholder='Type new friend name'
                        value= {newFrahnd}
                        onChange={handleChange}  //need to capture the value of what's entered
                    />
                    <button
                        onClick = { ()=> { handleAddFriend(newFrahnd) }}
                    >
                        Submit
                    </button>
                    <button
                        onClick = {clearAll}
                    >
                        Clear all
                    </button>
                {/* <Suspense fallback = {<Loader />} /> */}

                        <h2>Active friends</h2>
                            <FrahndsList 
                                list= {frahndqueue} 
                                isActive= {true}
                                onAddFriend = { handleAddFriend }
                                onRemoveFriend = { handleRemoveFriend }
                                onActivation = { handleActivation }
                                // should this also have an Activate function passed but unused?
                            />
                        <h2>Inactive friends</h2>
                            <FrahndsList 
                                list= {frahndqueue} 
                                isActive= {false}
                                onAddFriend = { handleAddFriend }
                                onRemoveFriend = { handleRemoveFriend }
                                onActivation = { handleActivation }
                                // should this also have a deactivate function passed but unused?
                            />
                    </section>
            )
        }
        const root = ReactDOM.createRoot(
            document.querySelector('#app')
        )
        root.render(<App />)
    </script>
</body>
</html>