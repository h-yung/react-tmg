<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herp Derp</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@7.0.0-beta.3/babel.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <section id="app">
    </section>

    <script>
        // to simulate async data fetching
        window.API = {
            fetchFrahnds(){
                return new Promise((res, rej) => {
                    const frahnds = [// frahnds data dumped here
                        {
                            name: 'Jake',
                            active: true,
                        }, 
                        {
                            name: 'Amy',
                            active: true,
                        }, 
                        {
                            name: 'Raymond',
                            active: true,
                        }, 
                        {
                            name: 'Charles',
                            active: true,
                        },
                        {
                            name: 'Rosa',
                            active: true,
                        }, 
                        {
                            name: 'Terry',
                            active: true,
                        }
                    ]
                    setTimeout(()=> res(frahnds), 2000) //resolve with the frahnds after 2s. faking the async nature of an ajax req
                })
            }
        }
    </script>


    <script type="text/babel">
        // tmg creates 2 separate components rather than templates within same FrahndsList component
        // filtered inside the App return rather than in the component
        function ActiveFriends(props){
            return (
                <section>
                    <h2>Active Friends</h2>
                    <ul>
                        {props.list
                            .map(frahnd => (
                                <li key={frahnd.name}> {/*React is zero amounts happy with this*/}
                                    <span>{frahnd.name}</span>
                                    <button onClick = { ()=> {props.onRemoveFriend(frahnd.name)} }>Bye {frahnd.name}!</button>
                                    <button onClick = { ()=> {props.onToggleFriend(frahnd.name)} }>Deactivate</button>
                            </li>
                        ))}
                    </ul>
                </section>
            )
        }
        function InactiveFriends(props){
            return (
                <section>
                    <h2>Active Friends</h2>
                    <ul>
                        {props.list
                            .map(frahnd => (
                            <li key={frahnd.name}> {/*React is zero amounts happy with this*/}
                                <span>{frahnd.name}</span>
                                <button onClick = { ()=> {props.onRemoveFriend(frahnd.name)} }>Bye {frahnd.name}!</button>
                                <button onClick = { ()=> {props.onToggleFriend(frahnd.name)} }>Activate</button>
                            </li>
                        ))}
                    </ul>
                </section>
            )
        }

        function App(){
            const { useState, useEffect } = React; //destructure from React; also add useEffect 
            
            let frahnds; /*one must fetch to fill this*/
            const [frahndqueue, setFrahndqueue] = useState([]); //notice: what was once in 'frahnds' has been ported to a simulated API, thus useState initial value is empty array
            
            const [newFrahnd, setNewFrahnd] = useState('')

            // we need to fetch data from our fake API at line ~19
            // the following function is hoisted within App() right? so it should logically work
            // not using componentDidMount; using useEffect
            
            useEffect(()=> { //takes a function as an arg
                API.fetchFrahnds()
                    //notice the fake API at line ~19 sends data already as obj - no need to .json() etc.
                    .then( data => {
                        frahnds = data;
                        setFrahndqueue(frahnds)
                        // console.log(`yo the frahnds are ${frahnds.map(frahnd => frahnd.name)}`)
                        
                    })
                    .catch(err => console.log(err))
                   /*I triggered infinite loop here originally w/o deps, because set'state' triggers rendering, then useEffect runs after each render
                   and also each time I guess I am creating a new object and when comparing dependencies, 2 objs are only equal if exactly the same obj
                   so don't use objs as dependencies*/
                    
            },[frahnds]) //not the best solution: figure out how to get rid of dependency entirely
                         //I had to keep the higher level var "frahnds" so that it would be visible for deps usage here
                        // I guess alt - if a real API - would be declaring the whole fetch API function inside but just above useEffect for access

            function handleChange(e){
                setNewFrahnd(e.target.value)
            }
            function handleAddFriend(name){
                if (frahndqueue.filter(frahnd => frahnd.name === name).length === 0){ //i.e., the friend isn't there already
                    const updatedFrahndQueue = frahndqueue.concat({name, active: true}) 
                    setFrahndqueue(updatedFrahndQueue) //now you make frahndqueue equal its updated self with the new frahnd
                    setNewFrahnd('') //clearing it after submission is best practice I think
                }
            }
            function toggleFriend(name){
                const frahndToEdit = frahndqueue.find(frahnd => frahnd.name === name)
                const updatedFrahndQueue = frahndqueue.filter(frahnd => frahnd.name !== name) 
                    .concat({ //then add a modified vers of the friend you removed
                        name,
                        active: !frahndToEdit.active //toggle to opposite of what it was
                    })
                setFrahndqueue(updatedFrahndQueue);
            }
            function clearAll(){
                setFrahndqueue([])
            }
            function handleRemoveFriend(name){
                const updatedFrahnds = frahndqueue.filter(friend => friend.name!==name)
                setFrahndqueue(updatedFrahnds)
            }
            return (
                <section id="container"> 
                    <h1>An odd tracker</h1>
                    <input 
                        type='text'
                        placeholder='Type new friend name'
                        value= {newFrahnd}
                        onChange={handleChange}  //need to capture the value of what's entered
                    />
                    <button
                        onClick = { ()=> { handleAddFriend(newFrahnd) }}
                    >
                        Submit
                    </button>
                    <button
                        onClick = {clearAll}
                    >Clear all
                    </button>
                    <ActiveFriends 
                        list= {frahndqueue.filter(frahnd => frahnd.active === true)} 
                    //  isActive= {false}
                        onAddFriend = { handleAddFriend }
                        onRemoveFriend = { handleRemoveFriend }
                        onToggleFriend = { toggleFriend }
                    />
                    <InactiveFriends
                        list= {frahndqueue.filter(frahnd => frahnd.active === false)}
                        onAddFriend = { handleAddFriend }
                        onRemoveFriend = { handleRemoveFriend }
                        onToggleFriend = { toggleFriend }
                    />
                        
                </section>
            )
        }
        const root = ReactDOM.createRoot(
            document.querySelector('#app')
        )
        root.render(<App />)
    </script>
</body>
</html>